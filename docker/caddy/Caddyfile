:80 {
    root * /srv
    encode gzip
    header remote_addr "{header.X-Forwarded-For}"

    handle_path /api/* {
        reverse_proxy bunsqstat_server:3000 {
            health_uri /health
            health_interval 10s
            # Enable WebSocket support
            header_up Upgrade {>Upgrade}
            header_up Connection {>Connection}
            header_up Sec-WebSocket-Key {>Sec-WebSocket-Key}
            header_up Sec-WebSocket-Version {>Sec-WebSocket-Version}
            header_up Sec-WebSocket-Extensions {>Sec-WebSocket-Extensions}
            header_up Sec-WebSocket-Protocol {>Sec-WebSocket-Protocol}
        }
    }

    file_server {
        hide .git
    }

    handle_errors {
        rewrite * /index.html
        file_server
    }
}
