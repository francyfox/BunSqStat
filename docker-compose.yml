services:
#  bunsqstat_client:
#    image: ghcr.io/francyfox/bunsqstat:v0.1.3
#    container_name: bunsqstat-client
#    restart: unless-stopped
#    ports:
#      - "80:80"      # Web interface
#      - "3000:3000"  # API (optional, for direct access)
#      - "6379:6379"  # Redis (optional, for external access)
#    environment:
#      - NODE_ENV=production # optional
#      - REDIS_PASSWORD=123 # optional
#      - SQUID_HOST=127.0.0.1 # optional
#      - SQUID_PORT=3128 # optional
#      - LOG_DIR=/app/logs
#    volumes:
#      - ./logs:/app/logs
#    healthcheck:
#      test: ["CMD", "curl", "-f", "http://localhost/api/health"]
#      interval: 30s
#      timeout: 10s
#      retries: 3
#      start_period: 30s

  redis:
    container_name: redis-bunsqstat
    image: redis/redis-stack:7.2.0-v18
    restart: unless-stopped
    ports:
      - "6379:6379"
    environment:
      - ALLOW_EMPTY_PASSWORD=false
      - REDIS_AOF_ENABLED=no
      - REDIS_PASSWORD=123
    command: redis-server ./redis-stack.conf --requirepass 123
    healthcheck:
      test: [ "CMD", "redis-cli", "--raw", "incr", "ping" ]
    volumes:
      - ./docker/redis/redis.conf:/redis-stack.conf
      - predis_data:/data
    networks:
      local:

  squid:
    user: "3128:3128"
    image: ghcr.io/b4tman/squid-ssl-bump:latest
    restart: unless-stopped
    ports:
      - "3128:3128"
      - "3129:3129"
    volumes:
      - ./docker/ssl:/etc/squid/ssl/
      - ./docker/squid.conf:/etc/squid/conf.d/squid.conf:ro
      - ./logs:/var/log/squid
    environment:
      - SQUID_CONFIG_FILE=/etc/squid/conf.d/squid.conf
    extra_hosts:
      - 'host.docker.internal:host-gateway'

volumes:
  predis_data:

networks:
  local:
  squid-net:
    driver: bridge